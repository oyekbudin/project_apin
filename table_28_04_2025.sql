DROP TABLE IF EXISTS "users" CASCADE;
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    registerdate TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    loginstatus BOOLEAN DEFAULT FALSE
);

DROP TABLE IF EXISTS "administrator";
CREATE TABLE administrator (
    idadmin SERIAL PRIMARY KEY,
    adminname VARCHAR(100) UNIQUE NOT NULL,
    role VARCHAR(50),
    password TEXT NOT NULL
) INHERITS (Users);

INSERT INTO administrator (name, adminname, role, password) VALUES (
    'Arvin Noer Hakim', 'hakimarvinnoer', 'SistemAdmin', '$2y$10$lQJrDb9WcSdWaGOkjIMQxOxLxt.QGKO2z2gJ5kowbxLlE2QGvyBfW'
);



DROP TABLE IF EXISTS "infaq_kelas";
DROP TABLE IF EXISTS "kelas";
CREATE TABLE kelas (
    id integer not null PRIMARY KEY,
    nama varchar(20) not null
);
CREATE TABLE infaq_kelas (
    id_infaq integer not null,
    id_kelas integer not null,
    PRIMARY KEY (id_infaq, id_kelas),
    FOREIGN KEY (id_infaq) REFERENCES infaq(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_kelas) REFERENCES kelas(id)
);
INSERT INTO kelas (id, nama) VALUES
(7, 'Kelas 7'),
(8, 'Kelas 8'),
(9, 'Kelas 9');

DROP TABLE IF EXISTS "siswa" CASCADE;
CREATE TABLE siswa (
    nis int UNIQUE NOT NULL PRIMARY KEY,
    phonenumber VARCHAR(15) NOT NULL,
    gender VARCHAR(1) NOT NULL,
    kelas integer NOT NULL
) INHERITS (Users);

DROP TABLE IF EXISTS "infaq" CASCADE;
CREATE TABLE infaq (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    harga int NOT NULL
);



DROP TABLE IF EXISTS "pembayaran";
CREATE TABLE pembayaran (
    id SERIAL PRIMARY KEY,
    date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    id_siswa int not null,
    id_infaq int not null,
    nominal numeric CHECK (nominal >= 0),
    payment_method VARCHAR(10) NOT NULL DEFAULT 'manual' CHECK (payment_method IN ('manual', 'midtrans')),
    order_id int not NULL, 
    payment_type VARCHAR(50) NULL, 
    status VARCHAR(15) NULL DEFAULT 'pending' CHECK (status IN ('success','pending', 'settlement', 'expire', 'cancel', 'deny', 'refund')),
    transaction_time TIMESTAMP NULL,
    fraud_status VARCHAR(20) NULL,
    snap_token TEXT NULL,

    FOREIGN KEY (id_siswa) REFERENCES siswa(nis) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (id_infaq) REFERENCES infaq(id) ON UPDATE CASCADE ON DELETE CASCADE
);

DROP TABLE IF EXISTS "tagihan" CASCADE;
CREATE TABLE tagihan (
    id SERIAL,
    id_siswa integer not null,
    id_infaq INTEGER NOT NULL,
    PRIMARY KEY (id, id_siswa, id_infaq),
    FOREIGN KEY (id_siswa) REFERENCES siswa(nis) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_infaq) REFERENCES infaq(id) ON DELETE CASCADE ON UPDATE CASCADE
);

DROP TABLE IF EXISTS "tagihan_detail";

DROP TABLE IF EXISTS "pesanwa";
CREATE TABLE pesanwa (
    id SERIAL PRIMARY KEY,
    jenis VARCHAR(50) UNIQUE NOT NULL,
    pesan TEXT NOT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO "siswa" ( "nis", "name", "kelas","phonenumber", "gender") VALUES
( 701, 'ALIYA QURROTUNNADA',  7, '081111111701', 'P'),
( 702, 'ARSHILLA NATASYA RIFKY',  7, '081111111702', 'P'),
( 703, 'BEKTI FIRMAN HAKIM',  7, '081111111703', 'L'),
( 704, 'DEA EINJELLIA',  7, '081111111704', 'P'),
( 705, 'ESA GALIH SATRIADI',  7, '081111111705', 'L'),
( 706, 'KEYZHA FITRI MAHARRANI',  7, '081111111706', 'P'),
( 707, 'KHOLIYAH NUR AISYAH',  7, '081111111707', 'P'),
( 708, 'LINDA WIDYANA ARUM',  7, '081111111708', 'P'),
( 709, 'LUKMAN HERYANA',  7, '081111111709', 'L'),
( 710, 'MULYANA',  7, '081111111710', 'L'),
( 711, 'MUTIARA NUR AZIZAH',  7, '081111111711', 'P'),
( 712, 'NUR AZIZAH',  7, '081111111712', 'P'),
( 713, 'NURCAHAYA SETIAWATI',  7, '081111111713', 'P'),
( 714, 'NURUL AZIZAH PRIHATIN',  7, '081111111714', 'P'),
( 715, 'RAFFI AHMAD FIRMANSYAH',  7, '081111111715', 'L'),
( 716, 'RAISA DEA ANGGRAENI',  7, '081111111716', 'P'),
( 717, 'RIFQI SIDIK MAULANA',  7, '081111111717', 'L'),
( 718, 'RIZKI',  7, '081111111718', 'L'),
( 719, 'RIVDA MUKARROMAH',  7, '081111111719', 'P'),
( 720, 'SAFIRA LAILATUL JANNAH',  7, '081111111720', 'P'),
( 721, 'SITI MAYSAROH',  7, '081111111721', 'P'),
( 722, 'SYARIF HIDAYAT',  7, '081111111722', 'L'),
( 723, 'WYLDAN ARIF PRAMONO',  7, '081111111723', 'L'),
( 801, 'ARINA FEBRIANA SULASTRI',  8, '081111111801', 'P'),
( 802, 'ARYA FENDI ANDIKA',  8, '081111111802', 'L'),
( 803, 'AZKA ZAENU RIFKI',  8, '081111111803', 'L'),
( 804, 'BILI BARA SAPUTRA',  8, '081111111804', 'L'),
( 805, 'CITRA AMELIA',  8, '081111111805', 'P'),
( 806, 'FAJAR ASHIDIK',  8, '081111111806', 'L'),
( 807, 'FAJRIATUS SOLEHAH',  8, '081111111807', 'P'),
( 808, 'FANREZA ANDIKA PUTRA',  8, '081111111808', 'L'),
( 809, 'FEBRI MAULANA',  8, '081111111809', 'L'),
( 810, 'FELLA MILKHATUN NAILA',  8, '081111111810', 'P'),
( 811, 'FITRI NUR AINI',  8, '081111111811', 'P'),
( 812, 'GISELL PUTRI SETIAWAN',  8, '081111111812', 'P'),
( 813, 'IRMA RIZQI FATMALA',  8, '081111111813', 'P'),
( 814, 'MELFI SYAHRIN AULIA',  8, '081111111814', 'P'),
( 815, 'MUHAMAD FADIL AL FAQIH',  8, '081111111815', 'L'),
( 816, 'MUTHI KHOIRIN NADA',  8, '081111111816', 'P'),
( 817, 'NUROHMAN',  8, '081111111817', 'L'),
( 818, 'RASTY NUR AISYAH',  8, '081111111818', 'P'),
( 819, 'RESTY NUR AINI',  8, '081111111819', 'P'),
( 820, 'REVI AGUSTINA',  8, '081111111820', 'P'),
( 821, 'RIZKI RAMADHAN',  8, '081111111821', 'L'),
( 822, 'SILFI DWI AFIFAH',  8, '081111111822', 'P'),
( 823, 'WAHYUNI ALVI KANIYA',  8, '081111111823', 'P'),
( 824, 'WULAN SRI HARYATI',  8, '081111111824', 'P'),
( 825, 'YENI OKTAVIA',  8, '081111111825', 'P'),
( 901, 'ABDUL AZIZ PRATAMA',  9, '081111111901', 'L'),
( 902, 'AIDA ROHMAWATI',  9, '081111111902', 'P'),
( 903, 'ALIF FADHIL MUZAKI',  9, '081111111903', 'L'),
( 904, 'ANDINI CAHYANINGSIH',  9, '081111111904', 'P'),
( 905, 'ANGGITA PUTRI AMELIA',  9, '081111111905', 'P'),
( 906, 'FALDI JUNIAR',  9, '081111111906', 'L'),
( 907, 'IBNU HAIZUL FADLI',  9, '081111111907', 'L'),
( 908, 'LUNA FATYA SABRINA',  9, '081111111908', 'P'),
( 909, 'MADIH ASSOFARI',  9, '081111111909', 'L'),
( 910, 'MUHAMAD SAUQIL HUDA',  9, '081111111910', 'L'),
( 911, 'MUHAMMAD DARSIMAN',  9, '081111111911', 'L'),
( 912, 'MUHAMMAD RENDRA H',  9, '081111111912', 'L'),
( 913, 'NUR DIANA',  9, '081111111913', 'P'),
( 914, 'QIYAN ARDIANSYAH',  9, '081111111914', 'L'),
( 915, 'WARID NUR HAMZAH',  9, '081111111915', 'L'),
( 916, 'WITA FITRIYANI',  9, '081111111916', 'P'),
( 826, 'RAFAEL SETIAWAN',  8, '081111111826', 'L'),
( 827, 'WAHYU DIKA PRATAMA',  8, '081111111827', 'L');
;


INSERT INTO "infaq" ("id", "name", "harga") VALUES
(1,	'Juli',	45000),
(2,	'Agustus',	45000),
(3,	'September',	45000),
(4,	'Oktober',	45000),
(5,	'November',	45000),
(6,	'Desember',	45000),
(7,	'Januari',	45000),
(8,	'Februari',	45000),
(9,	'Maret',	45000),
(10,	'April',	45000),
(11,	'Mei',	45000),
(12,	'Juni',	45000),
(13,	'ASTS 1',	50000),
(14,	'ASAS 1',	50000),
(15,	'ASTS 2',	50000),
(16,	'ASAT',	50000),
(17,	'Sarpras 1',	100000),
(18,	'Sarpras 2',	100000),
(19,	'Kegiatan 1',	50000),
(20,	'Kegiatan 2',	50000),
(21,	'Atribut',	80000),
(22,	'Raport',	40000),
(23,	'ANBK',	200000),
(24,	'ASAJ',	600000);

INSERT INTO "infaq_kelas" ("id_infaq", "id_kelas") VALUES
(1,	7),
(1,	8),
(1,	9),
(2,	7),
(2,	8),
(2,	9),
(3,	7),
(3,	8),
(3,	9),
(4,	7),
(4,	8),
(4,	9),
(5,	7),
(5,	8),
(5,	9),
(6,	7),
(6,	8),
(6,	9),
(7,	7),
(7,	8),
(7,	9),
(8,	7),
(8,	8),
(8,	9),
(9,	7),
(9,	8),
(9,	9),
(10,	7),
(10,	8),
(10,	9),
(11,	7),
(11,	8),
(11,	9),
(12,	7),
(12,	8),
(12,	9),
(13,	7),
(13,	8),
(13,	9),
(14,	7),
(14,	8),
(14,	9),
(15,	7),
(15,	8),
(16,	7),
(16,	8),
(16,	9),
(17,	7),
(17,	8),
(17,	9),
(18,	7),
(18,	8),
(18,	9),
(19,	7),
(19,	8),
(19,	9),
(20,	7),
(20,	8),
(20,	9),
(21,	7),
(22,	7),
(23,	8),
(24,	9);

INSERT INTO "pembayaran" ( "date", "id_siswa", "id_infaq", "nominal", "payment_method", "order_id",  "status") VALUES
( '09-04-25',709,15,50000,  'manual', '250409709',  'success'),
( '09-04-25',709,16,50000,  'manual', '250409709',  'success'),
( '09-04-25',709,18,100000,  'manual', '250409709',  'success'),
( '09-04-25',709,20,50000,  'manual', '250409709',  'success'),
( '09-04-25',721,3,45000,  'manual', '250409721',  'success'),
( '09-04-25',721,4,45000,  'manual', '250409721',  'success'),
( '09-04-25',721,5,45000,  'manual', '250409721',  'success'),
( '09-04-25',721,6,45000,  'manual', '250409721',  'success'),
( '09-04-25',721,7,45000,  'manual', '250409721',  'success'),
( '09-04-25',721,8,45000,  'manual', '250409721',  'success'),
( '09-04-25',721,17,10000,  'manual', '250409721',  'success'),
( '10-04-25',723,1,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,2,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,3,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,4,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,5,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,6,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,7,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,8,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,9,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,10,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,11,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,12,45000,  'manual', '250410723',  'success'),
( '10-04-25',723,13,50000,  'manual', '250410723',  'success'),
( '10-04-25',723,14,50000,  'manual', '250410723',  'success'),
( '10-04-25',723,15,50000,  'manual', '250410723',  'success'),
( '10-04-25',723,16,50000,  'manual', '250410723',  'success'),
( '10-04-25',723,17,100000,  'manual', '250410723',  'success'),
( '10-04-25',723,19,50000,  'manual', '250410723',  'success'),
( '10-04-25',723,18,10000,  'manual', '250410723',  'success'),
( '16-04-25',904,24,400000,  'manual', '250416904',  'success'),
( '16-04-25',909,24,200000,  'manual', '250416909',  'success'),
( '17-04-25',807,4,45000,  'manual', '250417807',  'success'),
( '17-04-25',807,5,45000,  'manual', '250417807',  'success'),
( '17-04-25',807,6,45000,  'manual', '250417807',  'success'),
( '17-04-25',807,7,45000,  'manual', '250417807',  'success'),
( '17-04-25',807,23,20000,  'manual', '250417807',  'success'),
( '21-04-25',910,24,600000,  'manual', '250421910',  'success'),
( '21-04-25',717,5,45000,  'manual', '250421717',  'success'),
( '21-04-25',717,6,45000,  'manual', '250421717',  'success'),
( '21-04-25',717,7,45000,  'manual', '250421717',  'success'),
( '21-04-25',717,8,45000,  'manual', '250421717',  'success'),
( '21-04-25',717,14,50000,  'manual', '250421717',  'success'),
( '21-04-25',717,15,50000,  'manual', '250421717',  'success'),
( '21-04-25',717,16,50000,  'manual', '250421717',  'success'),
( '21-04-25',717,17,100000,  'manual', '250421717',  'success'),
( '21-04-25',717,18,100000,  'manual', '250421717',  'success'),
( '21-04-25',717,19,50000,  'manual', '250421717',  'success'),
( '21-04-25',717,20,50000,  'manual', '250421717',  'success'),
( '21-04-25',717,21,80000,  'manual', '250421717',  'success'),
( '21-04-25',717,22,40000,  'manual', '250421717',  'success'),
( '21-04-25',806,23,200000,  'manual', '250421806',  'success'),
( '22-04-25',910,1,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,2,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,3,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,4,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,5,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,6,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,7,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,8,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,9,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,10,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,11,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,12,45000,  'manual', '250422910',  'success'),
( '22-04-25',910,14,50000,  'manual', '250422910',  'success'),
( '22-04-25',910,16,50000,  'manual', '250422910',  'success'),
( '22-04-25',910,17,100000,  'manual', '250422910',  'success'),
( '22-04-25',910,18,100000,  'manual', '250422910',  'success'),
( '22-04-25',910,19,50000,  'manual', '250422910',  'success'),
( '22-04-25',910,20,50000,  'manual', '250422910',  'success'),
( '22-04-25',915,24,300000,  'manual', '250422915',  'success'),
( '24-04-25',914,7,45000,  'manual', '250424914',  'success'),
( '24-04-25',914,8,45000,  'manual', '250424914',  'success'),
( '24-04-25',914,9,45000,  'manual', '250424914',  'success'),
( '24-04-25',914,10,45000,  'manual', '250424914',  'success'),
( '24-04-25',914,17,20000,  'manual', '250424914',  'success'),
( '26-04-25',903,24,600000,  'manual', '250426903',  'success'),
( '30-04-25',909,24,400000,  'manual', '250430909',  'success'),
( '30-04-25',909,9,45000,  'manual', '250430909',  'success'),
( '30-04-25',909,10,45000,  'manual', '250430909',  'success'),
( '06-05-25',914,17,50000,  'manual', '250506914',  'success'),
( '06-05-25',914,20,50000,  'manual', '250506914',  'success'),
( '06-05-25',906,24,300000,  'manual', '250506906',  'success'),
( '06-05-25',904,2,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,3,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,4,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,5,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,6,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,7,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,8,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,9,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,10,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,11,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,12,45000,  'manual', '250506904',  'success'),
( '06-05-25',904,16,50000,  'manual', '250506904',  'success'),
( '06-05-25',904,17,83000,  'manual', '250506904',  'success'),
( '06-05-25',904,18,100000,  'manual', '250506904',  'success'),
( '06-05-25',904,19,50000,  'manual', '250506904',  'success'),
( '06-05-25',904,20,50000,  'manual', '250506904',  'success'),
( '06-05-25',904,24,200000,  'manual', '250506904',  'success'),
( '06-05-25',901,24,500000,  'manual', '250506901',  'success');

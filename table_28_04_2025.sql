DROP TABLE IF EXISTS "users" CASCADE;
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    registerdate TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    loginstatus BOOLEAN DEFAULT FALSE
);

DROP TABLE IF EXISTS "administrator";
CREATE TABLE administrator (
    idadmin SERIAL PRIMARY KEY,
    adminname VARCHAR(100) UNIQUE NOT NULL,
    role VARCHAR(50),
    password TEXT NOT NULL
) INHERITS (Users);

INSERT INTO administrator (name, adminname, role, password) VALUES (
    'Arvin Noer Hakim', 'hakimarvinnoer', 'SistemAdmin', '$2y$10$lQJrDb9WcSdWaGOkjIMQxOxLxt.QGKO2z2gJ5kowbxLlE2QGvyBfW'
);



DROP TABLE IF EXISTS "infaq_kelas";
DROP TABLE IF EXISTS "kelas";
CREATE TABLE kelas (
    id integer not null PRIMARY KEY,
    nama varchar(20) not null
);
CREATE TABLE infaq_kelas (
    id_infaq integer not null,
    id_kelas integer not null,
    PRIMARY KEY (id_infaq, id_kelas),
    FOREIGN KEY (id_infaq) REFERENCES infaq(id) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_kelas) REFERENCES kelas(id)
);
INSERT INTO kelas (id, nama) VALUES
(7, 'Kelas 7'),
(8, 'Kelas 8'),
(9, 'Kelas 9');

DROP TABLE IF EXISTS "siswa" CASCADE;
CREATE TABLE siswa (
    nis int UNIQUE NOT NULL PRIMARY KEY,
    phonenumber VARCHAR(15) NOT NULL,
    gender VARCHAR(1) NOT NULL,
    kelas integer NOT NULL
) INHERITS (Users);

DROP TABLE IF EXISTS "infaq" CASCADE;
CREATE TABLE infaq (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    harga int NOT NULL
);



DROP TABLE IF EXISTS "pembayaran";
CREATE TABLE pembayaran (
    id SERIAL PRIMARY KEY,
    date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    id_siswa int not null,
    id_infaq int not null,
    nominal numeric CHECK (nominal >= 0),
    payment_method VARCHAR(10) NOT NULL DEFAULT 'manual' CHECK (payment_method IN ('manual', 'midtrans')),
    order_id int not NULL, 
    payment_type VARCHAR(50) NULL, 
    status VARCHAR(15) NULL DEFAULT 'pending' CHECK (status IN ('success','pending', 'settlement', 'expire', 'cancel', 'deny', 'refund')),
    transaction_time TIMESTAMP NULL,
    fraud_status VARCHAR(20) NULL,
    snap_token TEXT NULL,

    FOREIGN KEY (id_siswa) REFERENCES siswa(nis) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (id_infaq) REFERENCES infaq(id) ON UPDATE CASCADE ON DELETE CASCADE
);

DROP TABLE IF EXISTS "tagihan" CASCADE;
CREATE TABLE tagihan (
    id SERIAL,
    id_siswa integer not null,
    id_infaq INTEGER NOT NULL,
    PRIMARY KEY (id, id_siswa, id_infaq),
    FOREIGN KEY (id_siswa) REFERENCES siswa(nis) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_infaq) REFERENCES infaq(id) ON DELETE CASCADE ON UPDATE CASCADE
);

DROP TABLE IF EXISTS "tagihan_detail";

DROP TABLE IF EXISTS "pesanwa";
CREATE TABLE pesanwa (
    id SERIAL PRIMARY KEY,
    jenis VARCHAR(50) UNIQUE NOT NULL,
    pesan TEXT NOT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO "siswa" ("id", "name", "registerdate", "loginstatus", "nis", "phonenumber", "gender", "kelas") VALUES
(2,	'LUKMAN HERYANA',	'2025-05-05 19:19:02.993563',	'f',	709,	'081234567890',	'L',	7),
(3,	'SITI MAYSAROH',	'2025-05-05 19:19:25.911506',	'f',	721,	'081234567890',	'P',	7),
(4,	'WYLDAN ARIF PRAMONO',	'2025-05-05 19:19:49.966607',	'f',	723,	'08123456790',	'L',	7),
(5,	'ANDINI CAHYANINGSIH',	'2025-05-05 19:20:15.839943',	'f',	904,	'081234567890',	'P',	9),
(6,	'MADIH ASSOFARI',	'2025-05-05 19:20:37.932986',	'f',	909,	'081234567890',	'L',	9),
(7,	'FAJRIATUS SOLEHAH',	'2025-05-05 19:21:01.943215',	'f',	807,	'081234567890',	'P',	8),
(8,	'MUHAMAD SAUQIL HUDA',	'2025-05-05 19:21:21.373901',	'f',	910,	'081234567890',	'L',	9),
(9,	'RIFQI SIDIK MAULANA',	'2025-05-05 19:21:39.832643',	'f',	717,	'081234567890',	'L',	7),
(10,	'FAJAR ASHIDIK',	'2025-05-05 19:22:07.165714',	'f',	806,	'081234567890',	'L',	8),
(11,	'WARID NUR HAMZAH',	'2025-05-05 19:22:32.759802',	'f',	915,	'081234567890',	'L',	9),
(12,	'QIYAN ARDIANSYAH',	'2025-05-05 19:23:03.525806',	'f',	914,	'081234567890',	'L',	9),
(13,	'ALIF FADHIL MUZAKI',	'2025-05-05 19:23:27.886262',	'f',	903,	'081234567890',	'L',	9);

INSERT INTO "infaq" ("id", "name", "harga") VALUES
(1,	'Juli',	45000),
(2,	'Agustus',	45000),
(3,	'September',	45000),
(4,	'Oktober',	45000),
(5,	'November',	45000),
(6,	'Desember',	45000),
(7,	'Januari',	45000),
(8,	'Februari',	45000),
(9,	'Maret',	45000),
(10,	'April',	45000),
(11,	'Mei',	45000),
(12,	'Juni',	45000),
(13,	'ASTS 1',	50000),
(14,	'ASAS 1',	50000),
(15,	'ASTS 2',	50000),
(16,	'ASAT',	50000),
(17,	'Sarpras 1',	100000),
(18,	'Sarpras 2',	100000),
(19,	'Kegiatan 1',	50000),
(20,	'Kegiatan 2',	50000),
(21,	'Atribut',	80000),
(22,	'Raport',	40000),
(23,	'ANBK',	200000),
(24,	'ASAJ',	600000);

INSERT INTO "infaq_kelas" ("id_infaq", "id_kelas") VALUES
(1,	7),
(1,	8),
(1,	9),
(2,	7),
(2,	8),
(2,	9),
(3,	7),
(3,	8),
(3,	9),
(4,	7),
(4,	8),
(4,	9),
(5,	7),
(5,	8),
(5,	9),
(6,	7),
(6,	8),
(6,	9),
(7,	7),
(7,	8),
(7,	9),
(8,	7),
(8,	8),
(8,	9),
(9,	7),
(9,	8),
(9,	9),
(10,	7),
(10,	8),
(10,	9),
(11,	7),
(11,	8),
(11,	9),
(12,	7),
(12,	8),
(12,	9),
(13,	7),
(13,	8),
(13,	9),
(14,	7),
(14,	8),
(14,	9),
(15,	7),
(15,	8),
(16,	7),
(16,	8),
(16,	9),
(17,	7),
(17,	8),
(17,	9),
(18,	7),
(18,	8),
(18,	9),
(19,	7),
(19,	8),
(19,	9),
(20,	7),
(20,	8),
(20,	9),
(21,	7),
(22,	7),
(23,	8),
(24,	9);

INSERT INTO "tagihan" ("id", "id_siswa", "id_infaq") VALUES
(1,	709,	1),
(2,	721,	1),
(3,	723,	1),
(4,	717,	1),
(5,	807,	1),
(6,	806,	1),
(7,	904,	1),
(8,	909,	1),
(9,	910,	1),
(10,	915,	1),
(11,	914,	1),
(12,	903,	1),
(13,	709,	2),
(14,	721,	2),
(15,	723,	2),
(16,	717,	2),
(17,	807,	2),
(18,	806,	2),
(19,	904,	2),
(20,	909,	2),
(21,	910,	2),
(22,	915,	2),
(23,	914,	2),
(24,	903,	2),
(25,	709,	3),
(26,	721,	3),
(27,	723,	3),
(28,	717,	3),
(29,	807,	3),
(30,	806,	3),
(31,	904,	3),
(32,	909,	3),
(33,	910,	3),
(34,	915,	3),
(35,	914,	3),
(36,	903,	3),
(37,	709,	4),
(38,	721,	4),
(39,	723,	4),
(40,	717,	4),
(41,	807,	4),
(42,	806,	4),
(43,	904,	4),
(44,	909,	4),
(45,	910,	4),
(46,	915,	4),
(47,	914,	4),
(48,	903,	4),
(49,	709,	5),
(50,	721,	5),
(51,	723,	5),
(52,	717,	5),
(53,	807,	5),
(54,	806,	5),
(55,	904,	5),
(56,	909,	5),
(57,	910,	5),
(58,	915,	5),
(59,	914,	5),
(60,	903,	5),
(61,	709,	6),
(62,	721,	6),
(63,	723,	6),
(64,	717,	6),
(65,	807,	6),
(66,	806,	6),
(67,	904,	6),
(68,	909,	6),
(69,	910,	6),
(70,	915,	6),
(71,	914,	6),
(72,	903,	6),
(73,	709,	7),
(74,	721,	7),
(75,	723,	7),
(76,	717,	7),
(77,	807,	7),
(78,	806,	7),
(79,	904,	7),
(80,	909,	7),
(81,	910,	7),
(82,	915,	7),
(83,	914,	7),
(84,	903,	7),
(85,	709,	8),
(86,	721,	8),
(87,	723,	8),
(88,	717,	8),
(89,	807,	8),
(90,	806,	8),
(91,	904,	8),
(92,	909,	8),
(93,	910,	8),
(94,	915,	8),
(95,	914,	8),
(96,	903,	8),
(97,	709,	9),
(98,	721,	9),
(99,	723,	9),
(100,	717,	9),
(101,	807,	9),
(102,	806,	9),
(103,	904,	9),
(104,	909,	9),
(105,	910,	9),
(106,	915,	9),
(107,	914,	9),
(108,	903,	9),
(109,	709,	10),
(110,	721,	10),
(111,	723,	10),
(112,	717,	10),
(113,	807,	10),
(114,	806,	10),
(115,	904,	10),
(116,	909,	10),
(117,	910,	10),
(118,	915,	10),
(119,	914,	10),
(120,	903,	10),
(121,	709,	11),
(122,	721,	11),
(123,	723,	11),
(124,	717,	11),
(125,	807,	11),
(126,	806,	11),
(127,	904,	11),
(128,	909,	11),
(129,	910,	11),
(130,	915,	11),
(131,	914,	11),
(132,	903,	11),
(133,	709,	12),
(134,	721,	12),
(135,	723,	12),
(136,	717,	12),
(137,	807,	12),
(138,	806,	12),
(139,	904,	12),
(140,	909,	12),
(141,	910,	12),
(142,	915,	12),
(143,	914,	12),
(144,	903,	12),
(145,	709,	13),
(146,	721,	13),
(147,	723,	13),
(148,	717,	13),
(149,	807,	13),
(150,	806,	13),
(151,	904,	13),
(152,	909,	13),
(153,	910,	13),
(154,	915,	13),
(155,	914,	13),
(156,	903,	13),
(157,	709,	14),
(158,	721,	14),
(159,	723,	14),
(160,	717,	14),
(161,	807,	14),
(162,	806,	14),
(163,	904,	14),
(164,	909,	14),
(165,	910,	14),
(166,	915,	14),
(167,	914,	14),
(168,	903,	14),
(169,	709,	15),
(170,	721,	15),
(171,	723,	15),
(172,	717,	15),
(173,	807,	15),
(174,	806,	15),
(175,	709,	16),
(176,	721,	16),
(177,	723,	16),
(178,	717,	16),
(179,	807,	16),
(180,	806,	16),
(181,	904,	16),
(182,	909,	16),
(183,	910,	16),
(184,	915,	16),
(185,	914,	16),
(186,	903,	16),
(187,	709,	17),
(188,	721,	17),
(189,	723,	17),
(190,	717,	17),
(191,	807,	17),
(192,	806,	17),
(193,	904,	17),
(194,	909,	17),
(195,	910,	17),
(196,	915,	17),
(197,	914,	17),
(198,	903,	17),
(199,	709,	18),
(200,	721,	18),
(201,	723,	18),
(202,	717,	18),
(203,	807,	18),
(204,	806,	18),
(205,	904,	18),
(206,	909,	18),
(207,	910,	18),
(208,	915,	18),
(209,	914,	18),
(210,	903,	18),
(211,	709,	19),
(212,	721,	19),
(213,	723,	19),
(214,	717,	19),
(215,	807,	19),
(216,	806,	19),
(217,	904,	19),
(218,	909,	19),
(219,	910,	19),
(220,	915,	19),
(221,	914,	19),
(222,	903,	19),
(223,	709,	20),
(224,	721,	20),
(225,	723,	20),
(226,	717,	20),
(227,	807,	20),
(228,	806,	20),
(229,	904,	20),
(230,	909,	20),
(231,	910,	20),
(232,	915,	20),
(233,	914,	20),
(234,	903,	20),
(235,	709,	21),
(236,	721,	21),
(237,	723,	21),
(238,	717,	21),
(239,	709,	22),
(240,	721,	22),
(241,	723,	22),
(242,	717,	22),
(243,	807,	23),
(244,	806,	23),
(245,	904,	24),
(246,	909,	24),
(247,	910,	24),
(248,	915,	24),
(249,	914,	24),
(250,	903,	24);
